#+TITLE: Weather station information
* USB protcol

  The WH1080 identifies itself as USB ID =1941:8021=, some kind of serial
  over usb.  Blocks read are 32 bytes long.

* Memory layout

  http://www.jim-easterbrook.me.uk/weather/mm/

  Data stored in the WH1080 are of two different kinds, the 256 bytes
  long fixed block at position 0, and then 4080 16 byte records of
  stored data (or 3264 20-byte records in the 3080).

  | T   | Pack | Description         |                              |
  |-----+------+---------------------+------------------------------|
  | raw | ?    | raw                 |                              |
  | us  | n    | unsigned short      | 0xFFFF = undef               |
  | ub  | C    | unsigned byte       | 0xFF = undef                 |
  | dt  | H10  | date-time           | BCD YYmmddHHMM               |
  | ss  | n    | signed short        | 0xFFFF = undef, 0x8000 = neg |
  | sb  | C    | signed byte         | 0xFF = undef                 |
  | u3  | H6   | unsigned 3-byte int | 0xFFFFFF = undef, hex($_)    |
  | tt  | H4   | time                | BCD HHMM                     |

** data block

   | Addr |   |      |                              |    |                                                                                                    |
   |------+---+------+------------------------------+----+----------------------------------------------------------------------------------------------------|
   |    0 | 1 |      | delay                        | ub | Minutes since last stored reading.                                                                 |
   |    1 | 1 |      | indoor humidity              | ub |                                                                                                    |
   |    2 | 2 |      | indoor temperature           | ss | Multiply by 0.1 to get °C.                                                                         |
   |    4 | 1 |      | outdoor humidity             | ub |                                                                                                    |
   |    5 | 2 |      | outdoor temperature          | ss | Multiply by 0.1 to get °C.                                                                         |
   |    7 | 2 |      | absolute pressure            | us | Multiply by 0.1 to get hPa.                                                                        |
   |    9 | 1 |      | average wind speed, low bits | ub | Multiply by 0.1 to get m/s.                                                                        |
   |   10 | 1 |      | gust wind speed, low bits    | ub | Multiply by 0.1 to get m/s.                                                                        |
   |   11 | 1 |      | wind speed, high bits        | ub | Lower 4 bits are the average wind speed high bits, upper 4 bits are the gust wind speed high bits. |
   |   12 | 1 |      | wind direction               | ub | Multiply by 22.5 to get ° from north.                                                              |
   |   13 | 2 |      | total rain                   | us | Multiply by 0.3 to get mm.                                                                         |
   |   15 | 1 |      | status                       | bf | bit 6: 1 = loss of contact with sensors                                                            |
   |      |   |      |                              |    | bit 7: 1 = rain counter overflow                                                                   |
   |   16 | 3 | 3080 | illuminance                  | u3 | Multiply by 0.1 to get lux.                                                                        |
   |   19 | 1 | 3080 | UV                           | ub |                                                                                                    |

** The 256 bytes fixed block

   The fixed block has the following data:

   - F :: perl unpack format
   - T :: data type
   - V :: only in this version

   | Addr | B |    V | Item                                     | T   | Acc | Comment                                                                                                                                                                        |
   |------+---+------+------------------------------------------+-----+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   |    0 | 2 |      | EEPROM initialised flag                  | raw | R/W | Should be 0x55aa.                                                                                                                                                              |
   |    2 | 2 | 2080 | model                                    | us  | R/W | Expected to be 0x8010 (i.e. big-endian 1080)                                                                                                                                   |
   |    2 | 2 | 3080 | rain factor (?)                          | us  | R   | Divide by 8192                                                                                                                                                                 |
   |    4 | 1 | 2080 | version                                  | ub  | R/W | Expected to be 0x20                                                                                                                                                            |
   |    4 | 2 | 3080 | wind factor (?)                          | us  | R   | Divide by 8192                                                                                                                                                                 |
   |    5 | 2 | 2080 | ID                                       | us  | R/W | ?                                                                                                                                                                              |
   |    6 | 5 | 3080 | maximum, UV, when                        | dt  | R/W |                                                                                                                                                                                |
   |    7 | 2 | 2080 | rain factor (?)                          | us  | R/W | Divide by 8192                                                                                                                                                                 |
   |    9 | 2 | 2080 | wind factor (?)                          | us  | R/W | Divide by 8192                                                                                                                                                                 |
   |   11 | 2 | 2080 | inverted rain factor (?)                 | us  | R/W | Rain factor ^ 0xffff                                                                                                                                                           |
   |   11 | 5 | 3080 | maximum, illuminance, when               | dt  | R/W |                                                                                                                                                                                |
   |   13 | 2 | 2080 | inverted wind factor (?)                 | us  | R/W | Wind factor ^ 0xffff                                                                                                                                                           |
   |   16 | 1 |      | read period                              | ub  | R/W | Minutes between each stored reading                                                                                                                                            |
   |   17 | 1 |      | unit settings 1                          | bf  | R/W | bit 0: indoor temperature: 0 = °C, 1 = °F                                                                                                                                      |
   |      |   |      |                                          |     |     | bit 1: outdoor temperature: 0 = °C, 1 = °F                                                                                                                                     |
   |      |   |      |                                          |     |     | bit 2: rain: 0 = mm, 1 = inch                                                                                                                                                  |
   |      |   |      |                                          |     |     | bit 5: pressure: 1 = hPa                                                                                                                                                       |
   |      |   |      |                                          |     |     | bit 6: pressure: 1 = inHg                                                                                                                                                      |
   |      |   |      |                                          |     |     | bit 7: pressure: 1 = mmHg                                                                                                                                                      |
   |   18 | 1 |      | unit settings 2                          | bf  | R/W | bit 0: wind speed: 1 = m/s                                                                                                                                                     |
   |      |   |      |                                          |     |     | bit 1: wind speed: 1 = km/h                                                                                                                                                    |
   |      |   |      |                                          |     |     | bit 2: wind speed: 1 = knot                                                                                                                                                    |
   |      |   |      |                                          |     |     | bit 3: wind speed: 1 = m/h                                                                                                                                                     |
   |      |   |      |                                          |     |     | bit 4: wind speed: 1 = bft                                                                                                                                                     |
   |   19 | 1 |      | display options 1                        | bf  | R/W | bit 0: pressure: 0 = absolute, 1 = relative                                                                                                                                    |
   |      |   |      |                                          |     |     | bit 1: wind speed: 0 = average, 1 = gust                                                                                                                                       |
   |      |   |      |                                          |     |     | bit 2: time: 0 = 24 hour, 1 = 12 hour                                                                                                                                          |
   |      |   |      |                                          |     |     | bit 3: date: 0 = day-month-year, 1 = month-day-year                                                                                                                            |
   |      |   |      |                                          |     |     | bit 4: time scale(?): 0 = 12 hour, 1 = 24 hour                                                                                                                                 |
   |      |   |      |                                          |     |     | bit 5: date: 1 = show year year                                                                                                                                                |
   |      |   |      |                                          |     |     | bit 6: date: 1 = show day name                                                                                                                                                 |
   |      |   |      |                                          |     |     | bit 7: date: 1 = alarm time                                                                                                                                                    |
   |   20 | 1 |      | display options 2                        | bf  | R/W | bit 0: outdoor temperature: 1 = temperature                                                                                                                                    |
   |      |   |      |                                          |     |     | bit 1: outdoor temperature: 1 = wind chill                                                                                                                                     |
   |      |   |      |                                          |     |     | bit 2: outdoor temperature: 1 = dew point                                                                                                                                      |
   |      |   |      |                                          |     |     | bit 3: rain: 1 = hour                                                                                                                                                          |
   |      |   |      |                                          |     |     | bit 4: rain: 1 = day                                                                                                                                                           |
   |      |   |      |                                          |     |     | bit 5: rain: 1 = week                                                                                                                                                          |
   |      |   |      |                                          |     |     | bit 6: rain: 1 = month                                                                                                                                                         |
   |      |   |      |                                          |     |     | bit 7: rain: 1 = total                                                                                                                                                         |
   |   21 | 1 |      | alarm enable 1                           | bf  | R/W | bit 1: time                                                                                                                                                                    |
   |      |   |      |                                          |     |     | bit 2: wind direction                                                                                                                                                          |
   |      |   |      |                                          |     |     | bit 4: indoor humidity low                                                                                                                                                     |
   |      |   |      |                                          |     |     | bit 5: indoor humidity high                                                                                                                                                    |
   |      |   |      |                                          |     |     | bit 6: outdoor humidity low                                                                                                                                                    |
   |      |   |      |                                          |     |     | bit 7: outdoor humidity high                                                                                                                                                   |
   |   22 | 1 |      | alarm enable 2                           | bf  | R/W | bit 0: wind average                                                                                                                                                            |
   |      |   |      |                                          |     |     | bit 1: wind gust                                                                                                                                                               |
   |      |   |      |                                          |     |     | bit 2: rain hourly                                                                                                                                                             |
   |      |   |      |                                          |     |     | bit 3: rain daily                                                                                                                                                              |
   |      |   |      |                                          |     |     | bit 4: absolute pressure low                                                                                                                                                   |
   |      |   |      |                                          |     |     | bit 5: absolute pressure high                                                                                                                                                  |
   |      |   |      |                                          |     |     | bit 6: relative pressure low                                                                                                                                                   |
   |      |   |      |                                          |     |     | bit 7: relative pressure high                                                                                                                                                  |
   |   23 | 1 |      | alarm enable 3                           | bf  | R/W | bit 0: indoor temperature low                                                                                                                                                  |
   |      |   |      |                                          |     |     | bit 1: indoor temperature high                                                                                                                                                 |
   |      |   |      |                                          |     |     | bit 2: outdoor temperature low                                                                                                                                                 |
   |      |   |      |                                          |     |     | bit 3: outdoor temperature high                                                                                                                                                |
   |      |   |      |                                          |     |     | bit 4: wind chill low                                                                                                                                                          |
   |      |   |      |                                          |     |     | bit 5: wind chill high                                                                                                                                                         |
   |      |   |      |                                          |     |     | bit 6: dew point low                                                                                                                                                           |
   |      |   |      |                                          |     |     | bit 7: dew point high                                                                                                                                                          |
   |   24 | 1 |      | time zone                                | sb  | R/W | Hours offset from Central European Time, so in the UK this should be set to -1. In stations without a radio controlled clock this is always zero.                              |
   |   25 |   |      |                                          |     |     |                                                                                                                                                                                |
   |   26 | 1 |      | data refreshed                           | raw | R/W | Computer writes 0xAA to indicate a change of settings. Weather station clears value to acknowledge.                                                                            |
   |   27 | 2 |      | data count                               | us  | R/W | Number of stored readings. Starts at one, rises to 4080 (3264 in the 3080).                                                                                                    |
   |   29 | 1 | 3080 | display options 3                        | bf  | R/W | bit 0: illuminance: 0 = lux, 1 = foot-candle                                                                                                                                   |
   |      |   |      |                                          |     |     | bit 1: illuminance high alarm                                                                                                                                                  |
   |      |   |      |                                          |     |     | bit 2: UV high alarm                                                                                                                                                           |
   |      |   |      |                                          |     |     | bit 5: illuminance: 1 = W/m2                                                                                                                                                   |
   |   30 | 2 |      | current position                         | us  | R/W | Address of the currently stored record. Updated every 48 seconds or so, until the read period is reached. Then the address is incremented and the next record becomes current. |
   |   32 | 2 |      | relative pressure                        | us  | R   | Current relative (sea level) atmospheric pressure, multiply by 0.1 to get hPa.                                                                                                 |
   |   34 | 2 |      | absolute pressure                        | us  | R   | Current absolute atmospheric pressure, multiply by 0.1 to get hPa.                                                                                                             |
   |   36 | 2 | 3080 | Lux to W/m2 coefficient                  | us  | R/W | Divide by 10.                                                                                                                                                                  |
   |   38 | 2 | 2080 | wind correction factor                   | us  | R/W | Percent in range 75..125                                                                                                                                                       |
   |   40 | 2 | 2080 | outdoor temperature offset               | ss  | R/W | Multiply by 0.1 to get °C?                                                                                                                                                     |
   |   42 | 2 | 2080 | indoor temperature offset                | ss  | R/W | Multiply by 0.1 to get °C?                                                                                                                                                     |
   |   43 | 5 | 1080 | current date & time                      | dt  | R   |                                                                                                                                                                                |
   |   44 | 2 | 2080 | outdoor humidity offset                  | ss  | R/W | Unknown units                                                                                                                                                                  |
   |   46 | 2 | 2080 | indoor humidity offset                   | ss  | R/W | Unknown units                                                                                                                                                                  |
   |   48 | 1 |      | alarm, indoor humidity, high             | ub  | R/W |                                                                                                                                                                                |
   |   49 | 1 |      | alarm, indoor humidity, low              | ub  | R/W |                                                                                                                                                                                |
   |   50 | 2 |      | alarm, indoor temperature, high          | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |   52 | 2 |      | alarm, indoor temperature, low           | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |   54 | 1 |      | alarm, outdoor humidity, high            | ub  | R/W |                                                                                                                                                                                |
   |   55 | 1 |      | alarm, outdoor humidity, low             | ub  | R/W |                                                                                                                                                                                |
   |   56 | 2 |      | alarm, outdoor temperature, high         | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |   58 | 2 |      | alarm, outdoor temperature, low          | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |   60 | 2 |      | alarm, wind chill, high                  | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |   62 | 2 |      | alarm, wind chill, low                   | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |   64 | 2 |      | alarm, dew point, high                   | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |   66 | 2 |      | alarm, dew point, low                    | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |   68 | 2 |      | alarm, absolute pressure, high           | us  | R/W | Multiply by 0.1 to get hPa.                                                                                                                                                    |
   |   70 | 2 |      | alarm, absolute pressure, low            | us  | R/W | Multiply by 0.1 to get hPa.                                                                                                                                                    |
   |   72 | 2 |      | alarm, relative pressure, high           | us  | R/W | Multiply by 0.1 to get hPa.                                                                                                                                                    |
   |   74 | 2 |      | alarm, relative pressure, low            | us  | R/W | Multiply by 0.1 to get hPa.                                                                                                                                                    |
   |   76 | 1 |      | alarm, average wind speed, Beaufort      | ub  | R/W |                                                                                                                                                                                |
   |   77 | 2 |      | alarm, average wind speed, m/s           | us  | R/W | Multiply by 0.1 to get m/s.                                                                                                                                                    |
   |   79 | 1 |      | alarm, gust wind speed, Beaufort         | ub  | R/W |                                                                                                                                                                                |
   |   80 | 2 |      | alarm, gust wind speed, m/s              | us  | R/W | Multiply by 0.1 to get m/s.                                                                                                                                                    |
   |   82 | 1 |      | alarm, wind direction                    | ub  | R/W | Multiply by 22.5 to get ° from north.                                                                                                                                          |
   |   83 | 2 |      | alarm, rain, hourly                      | us  | R/W | Multiply by 0.1 to get mm.                                                                                                                                                     |
   |   85 | 2 |      | alarm, rain, daily                       | us  | R/W | Multiply by 0.1 to get mm.                                                                                                                                                     |
   |   87 | 2 |      | alarm, time                              | tt  | R/W | Hour & minute.                                                                                                                                                                 |
   |   89 | 3 | 3080 | alarm, illuminance                       | u3  | R/W | Multiply by 0.1 to get lux or fc, according to setting at address 29 bit 0.                                                                                                    |
   |   92 | 1 | 3080 | alarm, UV                                | ub  | R/W |                                                                                                                                                                                |
   |   93 | 1 | 3080 | maximum, UV, value                       | ub  | R/W |                                                                                                                                                                                |
   |   94 | 3 | 3080 | maximum, illuminance, value              | u3  | R/W | Multiply by 0.1 to get lux.                                                                                                                                                    |
   |   97 |   |      |                                          |     |     |                                                                                                                                                                                |
   |   98 | 1 |      | maximum, indoor humidity, value          | ub  | R/W |                                                                                                                                                                                |
   |   99 | 1 |      | minimum, indoor humidity, value          | ub  | R/W |                                                                                                                                                                                |
   |  100 | 1 |      | maximum, outdoor humidity, value         | ub  | R/W |                                                                                                                                                                                |
   |  101 | 1 |      | minimum, outdoor humidity, value         | ub  | R/W |                                                                                                                                                                                |
   |  102 | 2 |      | maximum, indoor temperature, value       | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |  104 | 2 |      | minimum, indoor temperature, value       | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |  106 | 2 |      | maximum, outdoor temperature, value      | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |  108 | 2 |      | minimum, outdoor temperature, value      | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |  110 | 2 |      | maximum, wind chill, value               | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |  112 | 2 |      | minimum, wind chill, value               | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |  114 | 2 |      | maximum, dew point, value                | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |  116 | 2 |      | minimum, dew point, value                | ss  | R/W | Multiply by 0.1 to get °C.                                                                                                                                                     |
   |  118 | 2 |      | maximum, absolute pressure, value        | us  | R/W | Multiply by 0.1 to get hPa.                                                                                                                                                    |
   |  120 | 2 |      | minimum, absolute pressure, value        | us  | R/W | Multiply by 0.1 to get hPa.                                                                                                                                                    |
   |  122 | 2 |      | maximum, relative pressure, value        | us  | R/W | Multiply by 0.1 to get hPa.                                                                                                                                                    |
   |  124 | 2 |      | minimum, relative pressure, value        | us  | R/W | Multiply by 0.1 to get hPa.                                                                                                                                                    |
   |  126 | 2 |      | maximum, average wind speed, value       | us  | R/W | Multiply by 0.1 to get m/s.                                                                                                                                                    |
   |  128 | 2 |      | maximum, gust wind speed, value          | us  | R/W | Multiply by 0.1 to get m/s.                                                                                                                                                    |
   |  130 | 2 |      | maximum, rain hourly, value              | us  | R/W | Multiply by 0.1 to get mm.                                                                                                                                                     |
   |  132 | 2 |      | maximum, rain daily, value               | us  | R/W | Multiply by 0.1 to get mm.                                                                                                                                                     |
   |  134 | 2 |      | maximum, rain weekly, value              | us  | R/W | Multiply by 0.1 to get mm.                                                                                                                                                     |
   |  136 | 2 |      | maximum, rain monthly, value             | us  | R/W | Multiply by 0.1 to get mm.                                                                                                                                                     |
   |  138 | 2 |      | maximum, rain total, value               | us  | R/W | Multiply by 0.1 to get mm.                                                                                                                                                     |
   |  140 | 1 |      | high nibble for month and total rainfall |     | R/W | high nibble - month rainfall, low nibble - total rainfall                                                                                                                      |
   |  141 | 5 |      | maximum, indoor humidity, when           | dt  | R/W |                                                                                                                                                                                |
   |  146 | 5 |      | minimum, indoor humidity, when           | dt  | R/W |                                                                                                                                                                                |
   |  151 | 5 |      | maximum, outdoor humidity, when          | dt  | R/W |                                                                                                                                                                                |
   |  156 | 5 |      | minimum, outdoor humidity, when          | dt  | R/W |                                                                                                                                                                                |
   |  161 | 5 |      | maximum, indoor temperature, when        | dt  | R/W |                                                                                                                                                                                |
   |  166 | 5 |      | minimum, indoor temperature, when        | dt  | R/W |                                                                                                                                                                                |
   |  171 | 5 |      | maximum, outdoor temperature, when       | dt  | R/W |                                                                                                                                                                                |
   |  176 | 5 |      | minimum, outdoor temperature, when       | dt  | R/W |                                                                                                                                                                                |
   |  181 | 5 |      | maximum, wind chill, when                | dt  | R/W |                                                                                                                                                                                |
   |  186 | 5 |      | minimum, wind chill, when                | dt  | R/W |                                                                                                                                                                                |
   |  191 | 5 |      | maximum, dew point, when                 | dt  | R/W |                                                                                                                                                                                |
   |  196 | 5 |      | minimum, dew point, when                 | dt  | R/W |                                                                                                                                                                                |
   |  201 | 5 |      | maximum, absolute pressure, when         | dt  | R/W |                                                                                                                                                                                |
   |  206 | 5 |      | minimum, absolute pressure, when         | dt  | R/W |                                                                                                                                                                                |
   |  211 | 5 |      | maximum, relative pressure, when         | dt  | R/W |                                                                                                                                                                                |
   |  216 | 5 |      | minimum, relative pressure, when         | dt  | R/W |                                                                                                                                                                                |
   |  221 | 5 |      | maximum, average wind speed, when        | dt  | R/W |                                                                                                                                                                                |
   |  226 | 5 |      | maximum, gust wind speed, when           | dt  | R/W |                                                                                                                                                                                |
   |  231 | 5 |      | maximum, rain hourly, when               | dt  | R/W |                                                                                                                                                                                |
   |  236 | 5 |      | maximum, rain daily, when                | dt  | R/W |                                                                                                                                                                                |
   |  241 | 5 |      | maximum, rain weekly, when               | dt  | R/W |                                                                                                                                                                                |
   |  246 | 5 |      | maximum, rain monthly, when              | dt  | R/W |                                                                                                                                                                                |
   |  251 | 5 |      | maximum, rain total, when                | dt  | R/W |                                                                                                                                                                                |
   |      |   |      |                                          |     |     |                                                                                                                                                                                |
